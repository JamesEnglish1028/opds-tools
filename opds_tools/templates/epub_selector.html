{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4 px-3">
<div class="container mt-4">
    <h3 class="text-primary text-uppercase mt-4 mb-4">
      <i class="bi bi-cloud-arrow-up me-2"></i> ONIX & EPUB Utilities
    </h3>
    <hr class="mt-0 mb-2">

  <div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-eye me-2"></i>Select an EPUB to Read</h5>
    </div>
    <div class="card-body">
      <form method="post">
        <div class="mb-3">
          <label for="book_url" class="form-label">Available EPUBs:</label>
          <select name="book_url" id="book_url" class="form-select" required>
            <option value="" disabled selected>Select an EPUB</option>
            {% for epub in epub_choices %}
              <option value="{{ epub.book_url }}">{{ epub.title }}</option>
            {% endfor %}
          </select>
        </div>
        <button type="submit" class="btn btn-primary">Open in Thorium</button>
      </form>

      <!-- Optional: Show preview of redirect URL on selection -->
      <div class="mt-3">
        <small class="text-muted">Redirect preview:</small>
        <code id="redirect-preview" class="d-block text-break text-secondary"></code>
      </div>
    </div>
  </div>
</div>
</div>

<script>
  const thoriumBase = "{{ thorium_url }}";
  const select = document.getElementById("book_url");
  const preview = document.getElementById("redirect-preview");

  select.addEventListener("change", function () {
    const selected = select.options[select.selectedIndex].value;
    if (selected) {
      preview.textContent = thoriumBase + "?book=" + selected;
    } else {
      preview.textContent = "";
    }
  });
</script>
{% endblock %}
